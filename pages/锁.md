-
- mutex 的数据结构
	- ```go
	  type Mutex struct {
	    state int32
	    sema uint32
	  }
	  ```
	-
	- state 每一位的含义
		- |bits|31~3|2|1|0|
		  |--|--|--|--|--|
		  |用途|等待队列长度|0=正常，1=饥饿|0=无唤醒，1=有唤醒|0=解锁，1=上锁|
			-
-
- ## mutex 使用注意事项
	- go 的 mutex 不是可重入锁
	- 不要拷贝 mutex（也就是说当我们将 mutex 当作函数参数传递的时候，不要进行值传递，而是要指针传递）
-
- ## mutex 的两种模式
	- 正常模式（效率高）
		- 等待队列：先进先出
		- 新手优势：先抢先排
		- 等待超过 1ms 进入饥饿模式
	- 饥饿模式（公平）
		- 严格排队，队首接盘
		- 牺牲效率，保p99
		- 适当时机，回归正常
	- 为啥正常模式的效率高？
		- 减少调度开销：由于新来的任务能够优先拿到锁，因此减少了调度
		- 充分利用缓存
-
- 🔧 检查死锁小工具
	- race detector，用法的时候在命令上加上 **-race** 即可
		- ```bash
		  go test -race mypkg
		  go run -race main.go
		  go build -race mycmd
		  go install -race mypkg
		  ```
		- 使用场景
			- 单元测试 ✅
			- 压力测试 ✅
			- 生产环境 ❌ ------- 由于会导致 10 倍 cpu 的消耗
-
-
-